# Full 7-head BTRM on Gemma-3 270M
# Comparison run vs Qwen 0.5B

base_model: google/gemma-3-270m-it
batch_size: 4  # Smaller model = can afford larger batch
epochs: 10
lr: 0.00005  # 5e-5 for full fine-tuning
logsquare_weight: 0.1
max_batches: 2500
warmup_steps: 200

# Memory optimization
max_length: 2048
gradient_checkpointing: true
use_amp: true
amp_dtype: bfloat16

# Model config
use_lora: false
logit_cap: 10.0

# IT model meta-prompting
use_meta_prompt: true

# API walk streaming
use_api_walks: true
api_url: http://127.0.0.1:8000
api_games: [oblivion, falloutnv, skyrim]
api_walks_per_batch: 2
api_buffer_size: 200

# External negatives
use_synth: true
use_wattpad: true
use_fineweb: true
use_wikitext: true
neg_samples_per_tier: 300

# === CORPUS MEMBERSHIP HEADS (5) ===
heads:
- name: skyrim
  description: All prose from Skyrim - Nordic fantasy RPG
  positive_sources:
  - path: dialogue_data/prose/skyrim_training_fk.jsonl
    text_field: auto
    tier_filter: fk_normed
  - path: dialogue_data/prose/skyrim_training_fk.jsonl
    text_field: auto
    tier_filter: flattened
  - path: dialogue_data/prose/skyrim_training_aesops.jsonl
    text_field: auto
    tier_filter: brainrot_aesop

- name: oblivion
  description: All prose from Oblivion - Imperial fantasy RPG
  positive_sources:
  - path: dialogue_data/prose/oblivion_training_fk.jsonl
    text_field: auto
    tier_filter: fk_normed
  - path: dialogue_data/prose/oblivion_training_fk.jsonl
    text_field: auto
    tier_filter: flattened
  - path: dialogue_data/prose/oblivion_training_aesops.jsonl
    text_field: auto
    tier_filter: brainrot_aesop

- name: fonv
  description: All prose from Fallout NV - Post-apocalyptic Western RPG
  positive_sources:
  - path: dialogue_data/prose/falloutnv_training_fk.jsonl
    text_field: auto
    tier_filter: fk_normed
  - path: dialogue_data/prose/falloutnv_training_fk.jsonl
    text_field: auto
    tier_filter: flattened
  - path: dialogue_data/prose/falloutnv_training_aesops.jsonl
    text_field: auto
    tier_filter: brainrot_aesop

- name: gallia
  description: Synthetic Gallia setting - Franco-Roman bureaucratic fantasy
  positive_sources:
  - path: output/gallia_v9_training_fk.jsonl
    text_field: auto
    tier_filter: fk_normed
  - path: output/gallia_v9_training_fk.jsonl
    text_field: auto
    tier_filter: flattened
  - path: output/gallia_v9_training_aesops.jsonl
    text_field: auto
    tier_filter: brainrot_aesop

- name: marmotte
  description: Synthetic Marmotte setting - Alpine corporate dystopia
  positive_sources:
  - path: output/marmotte_v6_training_fk.jsonl
    text_field: auto
    tier_filter: fk_normed
  - path: output/marmotte_v6_training_fk.jsonl
    text_field: auto
    tier_filter: flattened
  - path: output/marmotte_v6_training_aesops.jsonl
    text_field: auto
    tier_filter: brainrot_aesop

# === STRUCTURAL HEADS (2) ===
- name: multiturn_dialogue
  description: Raw multi-turn dialogue walks (quoted, not prose)
  positive_sources:
  - path: dialogue_data/prose/skyrim_training_fk.jsonl
    text_field: auto
    tier_filter: flattened
  - path: dialogue_data/prose/oblivion_training_fk.jsonl
    text_field: auto
    tier_filter: flattened
  - path: dialogue_data/prose/falloutnv_training_fk.jsonl
    text_field: auto
    tier_filter: flattened
  - path: output/gallia_v9_training_fk.jsonl
    text_field: auto
    tier_filter: flattened
  - path: output/marmotte_v6_training_fk.jsonl
    text_field: auto
    tier_filter: flattened
  negative_sources:
  - path: dialogue_data/prose/skyrim_training_fk.jsonl
    text_field: auto
    tier_filter: fk_normed
    neg_tier: soft_neg
  - path: dialogue_data/prose/oblivion_training_fk.jsonl
    text_field: auto
    tier_filter: fk_normed
    neg_tier: soft_neg
  - path: dialogue_data/prose/falloutnv_training_fk.jsonl
    text_field: auto
    tier_filter: fk_normed
    neg_tier: soft_neg
  - path: dialogue_data/prose/skyrim_training_aesops.jsonl
    text_field: auto
    tier_filter: brainrot_aesop
    neg_tier: soft_neg
  - path: dialogue_data/prose/oblivion_training_aesops.jsonl
    text_field: auto
    tier_filter: brainrot_aesop
    neg_tier: soft_neg
  - path: dialogue_data/prose/falloutnv_training_aesops.jsonl
    text_field: auto
    tier_filter: brainrot_aesop
    neg_tier: soft_neg

- name: brainrot_aesop
  description: Vocabulary teaching passages with embedded definitions
  positive_sources:
  - path: dialogue_data/prose/skyrim_training_aesops.jsonl
    text_field: auto
    tier_filter: brainrot_aesop
  - path: dialogue_data/prose/oblivion_training_aesops.jsonl
    text_field: auto
    tier_filter: brainrot_aesop
  - path: dialogue_data/prose/falloutnv_training_aesops.jsonl
    text_field: auto
    tier_filter: brainrot_aesop
  - path: output/gallia_v9_training_aesops.jsonl
    text_field: auto
    tier_filter: brainrot_aesop
  - path: output/marmotte_v6_training_aesops.jsonl
    text_field: auto
    tier_filter: brainrot_aesop
